# GS1 Pack - Документация

## Обзор

Новая вкладка "Фасовка GS1" реализует генерацию штрихкодов формата GS1 согласно техническому заданию. Вкладка поддерживает создание QR-кодов и опционально линейных штрихкодов для штучных и весовых товаров с возможностью применения скидок.

## Формат GS1

Штрихкод начинается с префикса `99MPUC<GS>`, где `<GS>` - символ разделителя ASCII 29.

### Структура для штучных товаров

```
99MPUC<GS>240[GoodsId]<GS>37[Quantity]<GS>[98[Discount]<GS>21[UniqueID]<GS>][97[DecPos]<GS>]
```

### Структура для весовых товаров

```
99MPUC<GS>240[GoodsId]<GS>3103[Weight]<GS>[98[Discount]<GS>21[UniqueID]<GS>]
```

## Application Identifiers (AI)

- **AI 240** - GoodsId (1-8 цифр)
- **AI 37** - Количество для штучного товара (8 цифр с ведущими нулями)
- **AI 3103** - Вес для весового товара в граммах (6 цифр)
- **AI 98** - Скидка в процентах (2 цифры, 0-99)
- **AI 21** - Уникальный идентификатор (8 символов, генерируется автоматически при наличии скидки)
- **AI 97** - Позиция десятичной запятой (1 цифра, используется для дробного количества штучных товаров)

## Функциональность

### 1. Форма добавления кодов

**Поля:**
- **Название папки** - Опциональное имя для группировки кодов
- **GoodsId коды** - Список кодов товаров (по одному на строку, 1-8 цифр)
- **Тип товара** - Радио-кнопки: "Штучный" / "Весовой"
- **Количество/Вес**:
  - Режим: Random / Фиксированный
  - Для штучного: диапазон или фиксированное значение (поддержка дробных чисел)
  - Для весового: диапазон или фиксированный вес в граммах
- **Скидка**:
  - Режим: Фиксированная / Random
  - Значение 0-99%
- **Вариаций** - Количество генерируемых кодов на каждый GoodsId (1-100)
- **Показать линейный штрихкод** - Чекбокс для отображения дополнительного линейного штрихкода

### 2. Управление папками

- Создание новых папок или добавление в существующие
- Переименование папок (кнопка ✎)
- Удаление папок (кнопка ×)
- Запуск ротации из выбранной папки (кнопка "Запуск")

### 3. Карусель с автоматической ротацией

**Функции:**
- Автоматическое переключение кодов с настраиваемым интервалом (0.5, 0.7, 1, 2 секунды)
- Ручная навигация кнопками ❮ / ❯
- Навигация с клавиатуры (стрелки ← →)
- Кнопки "Старт" / "Стоп" для управления ротацией
- Отображение QR-кода с использованием библиотеки bwip-js
- Опциональное отображение линейного штрихкода (Code128)
- Счётчик текущего кода (X/Y)
- Информация о товаре: GoodsId, Количество/Вес, Скидка

**Анимации:**
- Pulse-анимация при автоматической ротации
- Slide-анимация при ручной навигации
- Статичное отображение при паузе

### 4. Управление элементами

- Выбор/снятие выбора всех элементов в папке
- Удаление выбранных элементов
- Чекбоксы для активации/деактивации отдельных кодов

## Примеры использования

### Пример 1: Штучный товар, целое количество, без скидки

**Ввод:**
- GoodsId: 123
- Тип: Штучный
- Количество: 50
- Скидка: 0

**Результат:**
```
99MPUC<GS>240123<GS>3700000050<GS>
```

### Пример 2: Штучный товар, дробное количество, со скидкой

**Ввод:**
- GoodsId: 456789
- Тип: Штучный
- Количество: 12.45
- Скидка: 10%

**Результат:**
```
99MPUC<GS>240456789<GS>3700001245<GS>9810<GS>21[AUTO-ID]<GS>972<GS>
```
*Где [AUTO-ID] - автоматически сгенерированный 8-символьный уникальный идентификатор*

### Пример 3: Весовой товар, со скидкой

**Ввод:**
- GoodsId: 888777
- Тип: Весовой
- Вес: 500г
- Скидка: 5%

**Результат:**
```
99MPUC<GS>240888777<GS>3103000500<GS>9805<GS>21[AUTO-ID]<GS>
```

### Пример 4: Весовой товар, без скидки

**Ввод:**
- GoodsId: 99
- Тип: Весовой
- Вес: 1250г
- Скидка: 0

**Результат:**
```
99MPUC<GS>24099<GS>3103001250<GS>
```

## Технические детали

### Автоматическая генерация UniqueID

При наличии скидки (AI 98) автоматически генерируется уникальный 8-символьный идентификатор (AI 21), состоящий из букв A-Z и цифр 0-9.

### Обработка дробного количества

Для штучных товаров с дробным количеством автоматически:
1. Определяется количество знаков после запятой (decimal position)
2. Количество умножается на 10^(decimal position) для получения целого числа
3. Добавляется AI 97 с указанием позиции десятичной запятой

**Пример:** 12.45 шт → Quantity_raw = 1245, DecimalPosition = 2

### Валидация

- GoodsId: только цифры, 1-8 символов
- Количество (штучное): положительное число, до 99999998
- Вес (весовой): целое число в граммах, 100-999999
- Скидка: целое число, 0-99

## Хранение данных

Все созданные папки и коды сохраняются в localStorage и доступны после перезагрузки страницы. Поддерживается экспорт/импорт данных вместе с другими модулями приложения.

## Тестирование

Для тестирования функциональности открыть файл `test-gs1.html` в браузере. Тесты проверяют корректность генерации кодов согласно примерам из технического задания.

## Структура файлов

### Новые файлы:
- `js/controllers/gs1.controller.js` - Контроллер модуля GS1

### Изменённые файлы:
- `js/app/config.js` - Добавлены константы GS1
- `js/app/state.js` - Добавлена секция состояния gs1
- `js/generators/generators.js` - Добавлены функции генерации GS1
- `js/ui/ui.js` - Добавлены функции рендеринга GS1
- `js/main.js` - Добавлена привязка событий GS1
- `js/app/storage.js` - Добавлено сохранение gs1Folders
- `css/main.css` - Добавлены стили для GS1
- `index.html` - Добавлена вкладка и HTML структура

## Клавиатурные сокращения

- **← (Arrow Left)** - Предыдущий код (когда вкладка GS1 активна и есть элементы в ротации)
- **→ (Arrow Right)** - Следующий код (когда вкладка GS1 активна и есть элементы в ротации)

## Известные ограничения

- Максимум 100 вариаций на один GoodsId
- GoodsId должен содержать только цифры (1-8 символов)
- UniqueID генерируется случайным образом, проверка уникальности выполняется на стороне кассы/терминала
