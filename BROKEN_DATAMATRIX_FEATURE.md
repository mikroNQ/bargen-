# Функция "Сломанный DataMatrix"

## Описание
Новая функция для генерации намеренно повреждённых DataMatrix кодов для тестирования обработки ошибок сканирования.

## Расположение
**Вкладка:** DataMatrix  
**Секция:** Настройки двойного сканирования (после всех чекбоксов двойного сканирования)

## Использование

### 1. Активация функции
- Поставьте галочку на "Сломанный DataMatrix"
- Автоматически откроется панель с вложенными опциями

### 2. Выбор типа поломки

После активации основного чекбокса станут доступны 5 типов поломки:

#### **Удалить символы** (по умолчанию)
- Удаляет 5-10 случайных символов из кода
- **Рекомендуется** для имитации повреждённой этикетки
- Сканер точно не сможет прочитать такой код

#### **Испортить контрольную цифру**
- Изменяет несколько цифр GTIN в AI 01 (около 30% всех цифр)
- Имитирует ошибку печати или генерации
- Сканер обнаружит несоответствие контрольной суммы

#### **Заменить GS символы**
- Заменяет разделители GS (0x1D) на видимые символы (|||)
- Имитирует проблемы с кодировкой
- Сканер не сможет правильно разделить поля данных

#### **Добавить мусорные символы**
- Вставляет 10-15 случайных символов (X, Y, Z, Q, W, !, @, #, $, %, &, *)
- Имитирует грязь или дефекты печати
- Добавляет "шум" в код

#### **Случайный способ**
- Каждый раз применяет случайный метод из четырёх описанных выше
- Полезно для разнообразного тестирования

### 3. Поведение
- При включении чекбокса код сразу регенерируется как сломанный
- При переключении между типами поломки код обновляется автоматически
- Работает как в демо-режиме, так и при ротации из библиотеки
- При выключении чекбокса генерируется нормальный код

## Технические детали

### Файлы изменений
1. **index.html** - добавлен UI с чекбоксом и вложенными радио-кнопками
2. **css/main.css** - стили для nested-options и radio-label
3. **js/generators/generators.js** - функция `breakDataMatrix(code, method)`
4. **js/controllers/dm.controller.js** - интеграция проверки чекбокса в `generateAndDisplay()`
5. **js/main.js** - обработчики событий для чекбокса и радио-кнопок

### API функции breakDataMatrix()

```javascript
/**
 * @param {string} code - Оригинальный DataMatrix код
 * @param {string} method - Метод поломки:
 *   - 'removeChars' - удалить символы
 *   - 'wrongChecksum' - испортить контрольную сумму
 *   - 'replaceGS' - заменить GS разделители
 *   - 'addJunk' - добавить мусор
 *   - 'random' - случайный метод
 * @returns {string} Сломанный код
 */
BarGen.Generators.breakDataMatrix(code, method);
```

### Логирование
Функция выводит в консоль браузера информацию о примененном методе:
- `[BarGen Generators] Breaking DM: removed 2 chars at pos 15`
- `[BarGen Generators] Breaking DM: corrupted checksum digit`
- `[BarGen Generators] Breaking DM: replaced 3 GS separators`
- `[BarGen Generators] Breaking DM: added "X@#" at pos 20`

## Примеры использования

### Сценарий 1: Тестирование обработки ошибок
1. Включить "Сломанный DataMatrix"
2. Выбрать "Удалить символы"
3. Запустить ротацию из библиотеки
4. Все коды будут генерироваться с удалёнными символами

### Сценарий 2: Случайные ошибки
1. Включить "Сломанный DataMatrix"
2. Выбрать "Случайный способ"
3. Каждый новый код будет ломаться по-разному

### Сценарий 3: Специфический тест
1. Включить "Сломанный DataMatrix"
2. Выбрать "Заменить GS символы"
3. Тестировать парсинг DataMatrix с неправильными разделителями

## Взаимоисключающее поведение

⚠️ **Важно**: "Сломанный DataMatrix" несовместим с режимами двойного сканирования.

### Логика работы:
- ✅ Если включен "Сломанный DataMatrix" → все чекбоксы двойного сканирования **автоматически отключаются**
- ✅ Если включен любой режим двойного сканирования → "Сломанный DataMatrix" **автоматически отключается**
- ✅ Можно использовать **только один** из этих режимов за раз

### Почему так?
Сломанный DataMatrix предназначен для тестирования ошибок сканирования **одного** кода. Двойное сканирование требует генерации **двух** корректных кодов. Эти сценарии несовместимы по своей природе.

## Совместимость
- ❌ **НЕ** работает с двойным сканированием (взаимоисключающие режимы)
- ✅ Работает в демо-режиме
- ✅ Работает с ротацией из библиотеки
- ✅ Сохраняется в истории генерации
- ✅ Работает с навигацией по стрелкам

## Примечания
- Поломка применяется только к **основному** DataMatrix коду
- При включении "Сломанного DataMatrix" генерируется только **один** код (не два)
- Сломанный код всё равно будет отображаться визуально, но сканер его не прочитает
- Режим подходит для тестирования обработки **нечитаемых** кодов
